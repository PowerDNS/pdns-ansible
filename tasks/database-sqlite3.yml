---

- name: Install the SQLite dependencies on RedHat
  package:
    name: sqlite
    state: present
  when: ansible_os_family == 'RedHat'

- name: Install the SQLite dependencies on Debian
  package:
    name: sqlite3
    state: present
  when: ansible_os_family == 'Debian'

- name: Ensure that the directories containing the PowerDNS SQLite databases exist
  file:
    name: "{{ item | dirname }}"
    owner: "{{ pdns_user }}"
    group: "{{ pdns_group }}"
    state: directory
    mode: 0750
  with_items: "{{ pdns_sqlite_databases_locations }}"

- name: Create the PowerDNS SQLite databases
    shell: "sqlite3 {{ item }} < {{ pdns_sqlite3_schema_file }}"
    args:
      creates: "{{ item }}"
    with_items: "{{ pdns_sqlite_databases_locations }}"

- name: Check the PowerDNS SQLite databases permissions
  file:
    name: "{{ item }}"
    owner: "{{ pdns_user }}"
    group: "{{ pdns_group }}"
    mode: 0640
    state: file
  with_items: "{{ pdns_sqlite_databases_locations }}"
